{% extends "base.html" %} {% block main %}

<div class="screen position-relative">
  <div class="d-flex to-center">
    <div class="card card-show device">
      <div class="card-header position-relative">
        <div class="show-title">Device</div>
        <a href='{{ url_for("device.device_page") }}'>
          <img
            src="{{ url_for('static', filename='icon/icon-arrow-right.png' ) }}"
            alt="Uploaded Image"
            class="icon-header"
          />
        </a>
      </div>
      <div class="card-body">
        {% if not session.get("devices") %}
        <div class="text-center">You have 0 device.</div>
        {% else %}
        <div class="data-content">
          {# loop device key show in table#} {% if session.get("devices") %} {%
          for device_id in session.get("devices").keys() %}
          <div
            class="card card-width card-item"
            onclick='showDataDetail("{{device_id}}","device")'
          >
            <div class="card-body body-height position-relative">
              <div class="text-margin-top">
                Device Name: {{ session.get("devices")[device_id]
                ["device_name"] }}
              </div>
              <div>
                Device Type: {{ session.get("devices")[device_id]
                ["device_type"] }}
              </div>
              <div class="show-unprocess-data">
                Unprocessed Data: {% for un_data in
                session.get("devices")[device_id]["device_unprocessed"][:-1] %}
                {{ un_data }}, {% endfor %} {{ session.get("devices")[device_id]
                ["device_unprocessed"] [-1] }}
              </div>
            </div>
          </div>
          {% endfor %} {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
    <div class="card card-show service">
      <div class="card-header position-relative">
        <div class="show-title">Service</div>
        <a href='{{ url_for("service.service_page") }}'>
          <img
            src="{{ url_for('static', filename='icon/icon-arrow-right.png' ) }}"
            alt="Uploaded Image"
            class="icon-header"
          />
        </a>
      </div>
      <div class="card-body">
        {% if not session.get("services") %}
        <div class="text-center">You have 0 service.</div>
        {% else %}
        <div class="data-content">
          {# loop service key show in table#} {% if session.get("services") %}
          {% for service_id in session.get("services").keys() %}
          <div
            class="card card-width card-item"
            onclick='showDataDetail("{{service_id}}","service")'
          >
            <div class="card-body body-height position-relative">
              <div class="text-margin-top">
                Device Name: {{ session.get("services")[service_id]
                ["service_name"] }}
              </div>
              <div>
                Device Type: {{ session.get("services")[service_id]
                ["service_type"] }}
              </div>
            </div>
          </div>
          {% endfor %} {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock main %} {% block js %}
<script>
  $(document).ready(async function () {
    $.ajax("/session/get").then((doc) => {
      if (doc.tour == 1) {
        const driver = window.driver.js.driver;
        const driverObj = driver({
          showProgress: true,
          steps: [
            {
              element: ".device",
              popover: { title: "Device", description: "device section." },
            },
            {
              element: ".device .card-header img",
              popover: {
                title: "Device page",
                description: "go to device page.",
                onNextClick: () => {
                  window.location.href = "/device/device_page";
                  driverObj.moveNext();
                },
              },
            },
            {
              element: ".to-center .icon-header",
              popover: {
                title: "Add device",
                description: "open add device modal.",
              },
            },
            {
              element: "#addModal .modal-dialog",
              popover: {
                title: "Device page",
                description: "go to device page.",
              },
            },
          ],
        });
        const url = window.location.href;
        const params = new URLSearchParams(window.location.search);
        $(".card-item").each((index, doc) => {
          if ($(doc).attr("data-device-id") == params.get("device_id")) {
            $(doc).click();
          }
        });
        if (params.get("back") == "1") {
          window.history.pushState({}, "", `${url.split("?")[0]}`);
          driverObj.drive(1);
        } else {
          driverObj.drive();
        }
      }
    });
  });

  function showDataDetail(id, type) {
    window.location.href = `/${type}/${type}_page?${type}_id=` + id;
  }
</script>
{% endblock js %} {% block css %}
<style>
  .image-container {
    max-width: fit-content;
    /* Adjust the maximum width as needed */
    max-height: fit-content;
    /* Adjust the maximum width as needed */
    overflow-x: auto;
    /* Enable horizontal scroll when the image exceeds */
  }

  .img-fluid {
    max-width: 100%;
    /* Make the image responsive within the container */
  }
</style>
<style>
  .screen {
    width: 100vw;
    height: 100vh;
  }
  .card-show {
    width: 36.5vw;
    height: 39.2vw;
  }
  .card-show:first-child {
    margin-right: 3%;
  }
  .to-center {
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
  }
  .card-header {
    height: 5.68vw;
    font-size: 2.81vw;
    text-align: center;
    color: white;
  }
  .device .card-header {
    background-color: var(--device-color);
  }
  .service .card-header {
    background-color: var(--service-color);
  }
  .icon-header {
    position: absolute;
    right: 2%;
    top: 50%;
    transform: translateY(-50%);
    margin-right: 20px;
    width: 2.1vw;
    height: 2.1vw;
  }
  .show-title {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .device .body-height {
    height: 4.8vw;
    width: 100%;
    border-left: 1.21vw solid var(--device-color);
  }
  .service .body-height {
    height: 4.8vw;
    width: 100%;
    border-left: 1.21vw solid var(--service-color);
  }
  .card-width {
    width: 90%;
  }
  .card-item:not(:first-child) {
    margin-top: -1px;
  }
  .device .text-margin-top {
    margin-top: -0.45vw;
  }
  .service .text-margin-top {
    margin-top: 0.25vw;
  }
  .data-content {
    display: flex;
    justify-content: center;
    align-content: center;
    flex-wrap: wrap;
  }
  .card-item {
    cursor: pointer;
  }
  .card-selected {
    filter: brightness(0.7);
  }
  .show-unprocess-data {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
{% endblock css %}
